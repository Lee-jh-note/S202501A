<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="org.oracle.s202501a.mapper.EmpMapper">

	<select id="nytotalEmp" resultType="int"> <!-- #Count(*)Í∞Ä Ïù∏Ìä∏ :: Îß§Ìçº ÏïÑÏù¥ÎîîÎãπ sqlÎ¨∏ ÌïòÎÇò -->
		SELECT Count(*) FROM EMP
		WHERE emp_Delete = 0
	</select>
	
	
	

	<!-- Î∂ÄÏÑú Î≥¥Ïù¥Í≤å ÏßÅÏõê Î¶¨Ïä§Ìä∏ -->
	<!-- empÌÖåÏù¥Î∏îÏùò emp_no ÏàúÏúºÎ°ú dept_nameÎèÑ Î≥¥Ïó¨ÏßÄÎèÑÎ°ù -->
	<!-- org.oracle.s202501a.dto.ny_dto. Ïù¥Í±∞ ÏïàÎ∂ôÏù¥Í≥†Ïã∂ÏúºÎ©¥ Ïª®ÌîºÍ∑úÎ†àÏù¥ÏÖòÏóê ÎëêÏ§Ñ Î∂ôÏù¥Í∏∞ 1223 4ÏãúÍ∞Ñ 
		2Î∂Ñ -->
	<select id="nylistEmp" parameterType="org.oracle.s202501a.dto.ny_dto.Emp" resultType="org.oracle.s202501a.dto.ny_dto.Emp">
 <![CDATA[
    SELECT *
    FROM
    (
        SELECT rownum rn, a.*
        FROM
        (
            SELECT 
                e.emp_no,        
                e.emp_name,      
                e.dept_no,       
                e.position,      
                e.emp_tel,       
                e.emp_email,     
                e.birth,         
                e.hiredate,      
                d.dept_name
            FROM EMP e
            LEFT JOIN DEPT d
            ON e.dept_no = d.dept_no
            WHERE e.emp_Delete = 0 -- ÏÇ≠Ï†úÎêòÏßÄ ÏïäÏùÄ ÏßÅÏõêÎßå
            ORDER BY e.emp_no
        ) a
    )
    WHERE rn >= #{start}
      AND rn <= #{end}
  ]]>
	</select>



	<!-- ÏßÅÏõê ÏÉÅÏÑ∏Ï°∞Ìöå -->
	<select id="nylistEmpSelOne" parameterType="Long"
		resultType="org.oracle.s202501a.dto.ny_dto.Emp">
  <![CDATA[
    SELECT 
        e.emp_no,        -- ÏÇ¨Ïõê Î≤àÌò∏
        e.emp_name,      -- ÏÇ¨Ïõê Ïù¥Î¶Ñ
        e.dept_no,       -- Î∂ÄÏÑú Î≤àÌò∏
        e.position,      -- ÏßÅÍ∏â
        e.emp_tel,       -- Ï†ÑÌôîÎ≤àÌò∏
        e.emp_email,     -- Ïù¥Î©îÏùº
        e.birth,         -- ÏÉùÎÖÑÏõîÏùº
        e.hiredate,      -- ÏûÖÏÇ¨Ïùº
        e.emp_Delete,
        d.dept_name,      -- Î∂ÄÏÑú Ïù¥Î¶Ñ
        e.username,			  -- ÏïÑÏù¥Îîî(ÏÇ¨ÏõêÎ≤àÌò∏)
        e.Password  	 -- ÎπÑÎ∞ÄÎ≤àÌò∏ (Î∂ÄÏÑúÎ™Ö + ÏÉùÎÖÑÏõîÏùº)
      
    FROM EMP e
    LEFT JOIN DEPT d
    ON e.dept_no = d.dept_no
    WHERE e.emp_no = #{emp_No}  -- ÌäπÏ†ï ÏÇ¨Ïõê Î≤àÌò∏ Ï°∞Í±¥
  ]]>
	</select>



	<!-- ÏßÅÏõê ÏàòÏ†ï -->
	<!--#{} sqlÎ¨∏ ÏàúÏÑúÎç∞Î°ú Ï†ÅÏñ¥ÏïºÌï®. -->

	<update id="nyUpdateEmp" parameterType="org.oracle.s202501a.dto.ny_dto.Emp"> <!-- #{}Ïùò Ïù¥Î¶ÑÍ≥º ÎîîÌã∞Ïò§Ïóê ÏûàÎäî Ïª¨ÎüºÎ™Ö Í∞ôÎã§Î©¥ ÏïåÏïÑÏÑú Îì§Ïñ¥Ïò¥ -->
		
		
		UPDATE EMP
		SET
		emp_Name = #{emp_Name}, -- ÏßÅÏõê Ïù¥Î¶Ñ
		dept_No = #{dept_No}, -- Î∂ÄÏÑú Î≤àÌò∏
		position = #{position}, -- ÏßÅÍ∏â
		emp_Tel = #{emp_Tel}, -- Ï†ÑÌôîÎ≤àÌò∏
		emp_Email = #{emp_Email}, -- Ïù¥Î©îÏùº
		birth = #{birth}, -- ÏÉùÎÖÑÏõîÏùº
		hiredate = #{hiredate} -- ÏûÖÏÇ¨Ïùº
		WHERE emp_No = #{emp_No} -- ÏàòÏ†ïÌï† ÏßÅÏõê Î≤àÌò∏

	</update>
	
	
<!--	
// Ïú†Ï†ÄÏª®Ìä∏Î°§Îü¨ ÎèôÏùº 
// ÏßÅÏõê Îì±Î°ù	
<insert id="nyinsertEmp" parameterType="org.oracle.s202501a.dto.ny_dto.Emp">
    <selectKey keyProperty="EMP_NO_SEQ" resultType="Long" order="BEFORE">
        select EMP_NO_SEQ.nextval from dual
    </selectKey>
    <![CDATA[
    INSERT INTO EMP (
        emp_No,
        dept_No,       
        emp_Name,      
        emp_Tel,        Ï†ÑÌôîÎ≤àÌò∏ 
        emp_Email,      Ïù¥Î©îÏùº 
        password,      ÎπÑÎ∞ÄÎ≤àÌò∏ 
        birth,          ÏÉùÎÖÑÏõîÏùº 
        hiredate,      ÏûÖÏÇ¨Ïùº 
        roles,          ÏÇ¨Ïö©Ïûê Í∂åÌïú
        position,       ÏßÅÍ∏â 
        username,       ÏïÑÏù¥Îîî 
        emp_Delete      ÏÇ≠Ï†ú Ïó¨Î∂Ä 
    ) VALUES (
        EMP_NO_SEQ,
        #{dept_No},           Î∂ÄÏÑú Î≤àÌò∏ 
        #{emp_Name},          Ïù¥Î¶Ñ 
        #{emp_Tel},           Ï†ÑÌôîÎ≤àÌò∏ 
        #{emp_Email},         Ïù¥Î©îÏùº 
        #{password},          ÎπÑÎ∞ÄÎ≤àÌò∏ (Î∂ÄÏÑú Î™Ö+ ÏÉùÎÖÑÏõîÏùº('-'ÎπºÍ≥† 8ÏûêÎ¶¨)
        #{birth},             ÏÉùÎÖÑÏõîÏùº 
        #{hiredate},          ÏûÖÏÇ¨Ïùº 
        #{roles},             ÏÇ¨Ïö©Ïûê Í∂åÌïú
        #{position},          ÏßÅÍ∏â 
        TO_CHAR(EMP_NO_SEQ),  ÏïÑÏù¥Îîî  
        0                     ÏÇ≠Ï†ú Ïó¨Î∂Ä (1Ïù¥ ÏÇ≠Ï†ú) 
    )
    ]]>
</insert>
-->



<!-- ÏßÅÏõê ÏßÅÍ∏â ÏÑ†ÌÉù (Îì±Î°ù Ïãú)-->
	<select id="nySelectPos" resultType="org.oracle.s202501a.dto.ny_dto.Emp">	
 <![CDATA[
    SELECT DISTINCT position
    FROM emp
    WHERE position IS NOT NULL
    ORDER BY 
      CASE 
        WHEN position = 'Í¥ÄÎ¶¨Ïûê' THEN 1
        WHEN position = 'Î∂ÄÏû•' THEN 2
        WHEN position = 'ÎåÄÎ¶¨' THEN 3
        WHEN position = 'ÏÇ¨Ïõê' THEN 4
        ELSE 5  -- Í∏∞ÌÉÄ ÏßÅÍ∏âÏùÄ ÎßàÏßÄÎßâÏóê Ï†ïÎ†¨
      END
  ]]>
</select>

	<!-- ÏßÅÏõê ÏÇ≠Ï†úÏó¨Î∂ÄÎ•º 1Î°ú ÏóÖÎç∞Ïù¥Ìä∏ -->
	<update id="nyDelteUpdateEmp" parameterType="org.oracle.s202501a.dto.ny_dto.Emp">
		UPDATE EMP
		SET
		emp_Delete = 1
		WHERE emp_No = #{emp_No}
	</update>


	<!-- ÏßÅÏõê ÏÇ≠Ï†ú -->
	<!-- <delete id="nydeleteEmp" parameterType="int"> delete from EMP where 
		emp_No=#{emp_No} </delete> -->


	<!-- ÏßÅÏõê Í≤ÄÏÉâ -->
	<select id="nycondEmpTotal" parameterType="org.oracle.s202501a.dto.ny_dto.Emp" resultType="int">
	    SELECT COUNT(*) 
    FROM EMP e
    LEFT JOIN DEPT d ON e.dept_No = d.dept_No  
    <choose>  
       <when test="search == 's_dept'"> 
            WHERE LOWER(d.dept_Name) LIKE '%' || LOWER(#{keyword}) || '%'
        </when>
        <when test="search == 's_ename'">
            WHERE e.emp_Name LIKE '%' || #{keyword} || '%'
        </when>
    </choose>
</select>


	<select id="nySearchListEmp" parameterType="org.oracle.s202501a.dto.ny_dto.Emp"
		resultType="org.oracle.s202501a.dto.ny_dto.Emp">
		 SELECT *
    FROM (
        SELECT rownum rn, a.*
        FROM (
            SELECT e.emp_No, e.emp_Name, e.dept_No, e.position, 
                   e.emp_Tel, e.emp_Email, e.birth, e.hiredate, d.dept_Name  
            FROM EMP e
            LEFT JOIN DEPT d ON e.dept_No = d.dept_No
            WHERE 1=1
            <if test="dept_No != null and dept_No != ''">  
                AND e.dept_No = #{dept_No} 
            </if>
            <if test="keyword != null and keyword != ''">
                AND LOWER(e.emp_Name) LIKE '%' || LOWER(#{keyword}) || '%'  <!-- üîπ ÎåÄÏÜåÎ¨∏Ïûê Íµ¨Î∂Ñ ÏóÜÏù¥ Í≤ÄÏÉâ -->
            </if>
            ORDER BY e.emp_No
        ) a
    )
    WHERE rn BETWEEN #{start} AND #{end}
</select>




	<!-- ÏßÅÏõê&Î∂ÄÏÑú Î¶¨Ïä§Ìä∏ Ï°∞Ïù∏ ÌÖåÏù¥Î∏î Ï°∞Ìöå -->
	<select id="nyListEmpDept" resultType="org.oracle.s202501a.dto.ny_dto.Emp">
		select e.emp_No, e.emp_Name, e.emp_position, d.dept_Name, d.dept_Tel
		from EMP e, DEPT d
		where e.dept_no=d.dept_=No(+)
		order by Emp_No
	</select>
	   
   <select id="nyempConfirm" parameterType="String" resultType="org.oracle.s202501a.dto.ny_dto.Emp">
      select *
      from emp
      where emp_name = #{emp_name}
   </select>

</mapper>
